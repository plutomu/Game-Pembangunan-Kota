var rt=Object.defineProperty;var lt=(o,t,e)=>t in o?rt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var c=(o,t,e)=>(lt(o,typeof t!="symbol"?t+"":t,e),e),Me=(o,t,e)=>{if(!t.has(o))throw TypeError("Cannot "+e)};var l=(o,t,e)=>(Me(o,t,"read from private field"),e?e.call(o):t.get(o)),p=(o,t,e)=>{if(t.has(o))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(o):t.set(o,e)},L=(o,t,e,i)=>(Me(o,t,"write to private field"),i?i.call(o,e):t.set(o,e),e);var Te=(o,t,e,i)=>({set _(s){L(o,t,s,e)},get _(){return l(o,t,i)}}),u=(o,t,e)=>(Me(o,t,"access private method"),e);import{T as ht,G as dt,S as ct,M as ut,a as mt,V as b,O as pt,b as Xe,c as ft,d as gt,D as B,C as wt,L as bt,e as H,B as At,f as yt,R as Mt,g as Tt,h as vt,i as Ae,j as ve,W as Lt,k as xt,P as St,l as zt,m as Ct,n as Bt,o as Et,A as Wt}from"./vendor-ac5f01af.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const kt={base:"/",root:"src",publicDir:"public",build:{outDir:"../dist",emptyOutDir:!0,chunkSizeWarningLimit:1e3,rollupOptions:{output:{manualChunks(o){if(o.includes("node_modules"))return"vendor"}}}}},Le={"under-construction":{type:"zone",filename:"construction-small.glb",scale:3},"residential-A1":{type:"zone",filename:"building-house-block-big.glb"},"residential-B1":{type:"zone",filename:"building-house-family-small.glb"},"residential-C1":{type:"zone",filename:"building-house-family-large.glb"},"residential-A2":{type:"zone",filename:"building-block-4floor-short.glb"},"residential-B2":{type:"zone",filename:"building-block-4floor-corner.glb"},"residential-C2":{type:"zone",filename:"building-block-5floor.glb"},"residential-A3":{type:"zone",filename:"building-office-balcony.glb"},"residential-B3":{type:"zone",filename:"building-office-pyramid.glb"},"residential-C3":{type:"zone",filename:"building-office-tall.glb"},"commercial-A1":{type:"zone",filename:"building-cafe.glb"},"commercial-B1":{type:"zone",filename:"building-burger-joint.glb"},"commercial-C1":{type:"zone",filename:"building-restaurant.glb"},"commercial-A2":{type:"zone",filename:"building-cinema.glb"},"commercial-B2":{type:"zone",filename:"building-casino.glb"},"commercial-C2":{type:"zone",filename:"data-center.glb"},"commercial-A3":{type:"zone",filename:"building-office.glb"},"commercial-B3":{type:"zone",filename:"building-office-big.glb"},"commercial-C3":{type:"zone",filename:"building-skyscraper.glb"},"industrial-A1":{type:"zone",filename:"industry-factory.glb"},"industrial-B1":{type:"zone",filename:"industry-refinery.glb"},"industrial-C1":{type:"zone",filename:"industry-warehouse.glb"},"industrial-A2":{type:"zone",filename:"industry-factory.glb"},"industrial-B2":{type:"zone",filename:"industry-refinery.glb"},"industrial-C2":{type:"zone",filename:"industry-warehouse.glb"},"industrial-A3":{type:"zone",filename:"industry-factory.glb"},"industrial-B3":{type:"zone",filename:"industry-refinery.glb"},"industrial-C3":{type:"zone",filename:"industry-warehouse.glb"},"power-plant":{type:"power",filename:"industry-factory-old.glb"},"power-line":{type:"power",filename:"power_line_pole_modified.glb"},"road-straight":{type:"road",filename:"tile-road-straight.glb",castShadow:!1},"road-end":{type:"road",filename:"tile-road-end.glb",castShadow:!1},"road-corner":{type:"road",filename:"tile-road-curve.glb",castShadow:!1},"road-three-way":{type:"road",filename:"tile-road-intersection-t.glb",castShadow:!1},"road-four-way":{type:"road",filename:"tile-road-intersection.glb",castShadow:!1},grass:{type:"terrain",filename:"tile-plain_grass.glb",castShadow:!1},"car-taxi":{type:"vehicle",filename:"car-taxi.glb",rotation:90},"car-police":{type:"vehicle",filename:"car-police.glb",rotation:90},"car-passenger":{type:"vehicle",filename:"car-passenger.glb",rotation:90},"car-veteran":{type:"vehicle",filename:"car-veteran.glb",rotation:90},truck:{type:"vehicle",filename:"truck.glb",rotation:90},"car-hippie-van":{type:"vehicle",filename:"car-hippie-van.glb",rotation:90},"car-tow-truck":{type:"vehicle",filename:"car-tow-truck.glb",rotation:90},"car-ambulance-pickup":{type:"vehicle",filename:"car-ambulance-pickup.glb",rotation:90},"car-passenger-race":{type:"vehicle",filename:"car-passenger-race.glb",rotation:90},"car-baywatch":{type:"vehicle",filename:"car-baywatch.glb",rotation:90},"car-truck-dump":{type:"vehicle",filename:"car-truck-dump.glb",rotation:90},"car-truck-armored-truck":{type:"vehicle",filename:"armored-truck.glb",rotation:90}},K=kt.base;var V,Z,le,Qe;class Rt{constructor(t){p(this,V);p(this,le);c(this,"textureLoader",new ht);c(this,"modelLoader",new dt);c(this,"textures",{base:u(this,V,Z).call(this,`${K}textures/base.png`),specular:u(this,V,Z).call(this,`${K}textures/specular.png`),grid:u(this,V,Z).call(this,`${K}textures/grid.png`)});c(this,"statusIcons",{"no-power":u(this,V,Z).call(this,`${K}statusIcons/no-power.png`,!0),"no-road-access":u(this,V,Z).call(this,`${K}statusIcons/no-road-access.png`,!0)});c(this,"models",{});c(this,"sprites",{});this.modelCount=Object.keys(Le).length,this.loadedModelCount=0;for(const[e,i]of Object.entries(Le))u(this,le,Qe).call(this,e,i);this.onLoad=t}getModel(t,e,i=!1){const s=this.models[t].clone();return s.traverse(n=>{n.userData=e,n.material&&(n.material=n.material.clone(),n.material.transparent=i)}),s}}V=new WeakSet,Z=function(t,e=!1){const i=this.textureLoader.load(t);return i.colorSpace=ct,i.flipY=e,i},le=new WeakSet,Qe=function(t,{filename:e,scale:i=1,rotation:s=0,receiveShadow:n=!0,castShadow:a=!0}){this.modelLoader.load(`${K}models/${e}`,r=>{let h=r.scene;h.name=e,h.traverse(f=>{f.material&&(f.material=new ut({map:this.textures.base,specularMap:this.textures.specular}),f.receiveShadow=n,f.castShadow=a)}),h.rotation.set(0,mt.degToRad(s),0),h.scale.set(i/30,i/30,i/30),this.models[t]=h,this.loadedModelCount++,this.loadedModelCount==this.modelCount&&this.onLoad()},r=>{},r=>{console.error(r)})};const Y=Math.PI/180,De=2,q=5,Pt=.1,Ot=5,Dt=45,It=45,Nt=.2,Vt=.2,Gt=.002,Ie=-.01,Ne=new b(0,1,0);class jt{constructor(){const t=window.ui.gameWindow.clientWidth/window.ui.gameWindow.clientHeight;this.camera=new pt(q*t/-2,q*t/2,q/2,q/-2,1,1e3),this.camera.layers.enable(1),this.cameraOrigin=new b(8,0,8),this.cameraRadius=.5,this.cameraAzimuth=225,this.cameraElevation=45,this.updateCameraPosition(),window.ui.gameWindow.addEventListener("wheel",this.onMouseScroll.bind(this),!1),window.ui.gameWindow.addEventListener("mousedown",this.onMouseMove.bind(this),!1),window.ui.gameWindow.addEventListener("mousemove",this.onMouseMove.bind(this),!1)}updateCameraPosition(){this.camera.zoom=this.cameraRadius,this.camera.position.x=100*Math.sin(this.cameraAzimuth*Y)*Math.cos(this.cameraElevation*Y),this.camera.position.y=100*Math.sin(this.cameraElevation*Y),this.camera.position.z=100*Math.cos(this.cameraAzimuth*Y)*Math.cos(this.cameraElevation*Y),this.camera.position.add(this.cameraOrigin),this.camera.lookAt(this.cameraOrigin),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld()}onMouseMove(t){if(t.buttons&De&&!t.ctrlKey&&(this.cameraAzimuth+=-(t.movementX*Nt),this.cameraElevation+=t.movementY*Vt,this.cameraElevation=Math.min(It,Math.max(Dt,this.cameraElevation))),t.buttons&De&&t.ctrlKey){const e=new b(0,0,1).applyAxisAngle(Ne,this.cameraAzimuth*Y),i=new b(1,0,0).applyAxisAngle(Ne,this.cameraAzimuth*Y);this.cameraOrigin.add(e.multiplyScalar(Ie*t.movementY)),this.cameraOrigin.add(i.multiplyScalar(Ie*t.movementX))}this.updateCameraPosition()}onMouseScroll(t){this.cameraRadius*=1-t.deltaY*Gt,this.cameraRadius=Math.min(Ot,Math.max(Pt,this.cameraRadius)),this.updateCameraPosition()}resize(){const t=window.ui.gameWindow.clientWidth/window.ui.gameWindow.clientHeight;this.camera.left=q*t/-2,this.camera.right=q*t/2,this.camera.updateProjectionMatrix()}}var he,Ke,de,qe,ce,Ze;class Ht{constructor(){p(this,he);p(this,de);p(this,ce);c(this,"mouse",{x:0,y:0});c(this,"isLeftMouseDown",!1);c(this,"isMiddleMouseDown",!1);c(this,"isRightMouseDown",!1);window.ui.gameWindow.addEventListener("mousedown",u(this,he,Ke).bind(this),!1),window.ui.gameWindow.addEventListener("mouseup",u(this,de,qe).bind(this),!1),window.ui.gameWindow.addEventListener("mousemove",u(this,ce,Ze).bind(this),!1),window.ui.gameWindow.addEventListener("contextmenu",t=>t.preventDefault(),!1)}}he=new WeakSet,Ke=function(t){t.button===0&&(this.isLeftMouseDown=!0),t.button===1&&(this.isMiddleMouseDown=!0),t.button===2&&(this.isRightMouseDown=!0)},de=new WeakSet,qe=function(t){t.button===0&&(this.isLeftMouseDown=!1),t.button===1&&(this.isMiddleMouseDown=!1),t.button===2&&(this.isRightMouseDown=!1)},ce=new WeakSet,Ze=function(t){this.isLeftMouseDown=t.buttons&1,this.isRightMouseDown=t.buttons&2,this.isMiddleMouseDown=t.buttons&4,this.mouse.x=t.clientX,this.mouse.y=t.clientY};const M={residential:"residential",commercial:"commercial",industrial:"industrial",road:"road",powerPlant:"power-plant",powerLine:"power-line"},w={modules:{development:{abandonThreshold:10,abandonChance:.25,constructionTime:3,levelUpChance:.05,redevelopChance:.25},jobs:{maxWorkers:2},residents:{maxResidents:2,residentMoveInChance:.5},roadAccess:{searchDistance:3}},citizen:{minWorkingAge:16,retirementAge:65,maxJobSearchDistance:4},vehicle:{speed:5e-4,fadeTime:500,maxLifetime:1e4,spawnInterval:1e3}};class re{simulate(t){}dispose(){}toHTML(){}}const y={abandoned:"abandoned",developed:"developed",underConstruction:"under-construction",undeveloped:"undeveloped"};var $,_,se,ne,G,oe,xe,ue,_e;class Yt extends re{constructor(e){super();p(this,oe);p(this,ue);p(this,$,0);p(this,_,0);p(this,se,1);c(this,"maxLevel",3);p(this,ne,y.undeveloped);p(this,G,void 0);L(this,G,e)}get level(){return l(this,se)}set level(e){L(this,se,e),l(this,G).refreshView()}get state(){return l(this,ne)}set state(e){L(this,ne,e),l(this,G).refreshView()}simulate(e){switch(u(this,ue,_e).call(this),this.state){case y.undeveloped:u(this,oe,xe).call(this)&&Math.random()<w.modules.development.redevelopChance&&(this.state=y.underConstruction,L(this,_,0));break;case y.underConstruction:++Te(this,_)._===w.modules.development.constructionTime&&(this.state=y.developed,this.level=1,L(this,_,0));break;case y.developed:l(this,$)>w.modules.development.abandonThreshold?Math.random()<w.modules.development.abandonChance&&(this.state=y.abandoned):this.level<this.maxLevel&&Math.random()<w.modules.development.levelUpChance&&this.level++;break;case y.abandoned:l(this,$)==0&&Math.random()<w.modules.development.redevelopChance&&(this.state=y.developed);break}}toHTML(){return`
        <span class="info-label">State </span>
        <span class="info-value">${this.state}</span>
        <br>
        <span class="info-label">Level </span>
        <span class="info-value">${this.level}</span>
        <br>`}}$=new WeakMap,_=new WeakMap,se=new WeakMap,ne=new WeakMap,G=new WeakMap,oe=new WeakSet,xe=function(){return l(this,G).roadAccess.value&&l(this,G).power.isFullyPowered},ue=new WeakSet,_e=function(){u(this,oe,xe).call(this)?L(this,$,0):Te(this,$)._++};const Jt=11184725,$t=5592405;var k,U,F,te;class ze extends Xe{constructor(e=0,i=0){super();p(this,F);p(this,k,null);p(this,U,new b);this.name="SimObject",this.position.x=e,this.position.z=i}get x(){return this.getWorldPosition(l(this,U)),Math.floor(l(this,U).x)}get y(){return this.getWorldPosition(l(this,U)),Math.floor(l(this,U).z)}get mesh(){return l(this,k)}setMesh(e){l(this,k)&&(this.dispose(),this.remove(l(this,k))),L(this,k,e),l(this,k)&&this.add(l(this,k))}simulate(e){}setSelected(e){e?u(this,F,te).call(this,Jt):u(this,F,te).call(this,0)}setFocused(e){e?u(this,F,te).call(this,$t):u(this,F,te).call(this,0)}dispose(){l(this,k).traverse(e=>{var i;e.material&&((i=e.material)==null||i.dispose())})}}k=new WeakMap,U=new WeakMap,F=new WeakSet,te=function(e){this.mesh&&this.mesh.traverse(i=>{var s,n;return(n=(s=i.material)==null?void 0:s.emissive)==null?void 0:n.setHex(e)})};const J={NoPower:"no-power",NoRoadAccess:"no-road-access",Ok:"ok"};class Ut extends re{constructor(e){super();c(this,"supplied",0);c(this,"required",0);this.required=this.supplied}get isFullyPowered(){return this.supplied>=this.required}}class Ft extends re{constructor(e){super();c(this,"building");c(this,"enabled",!0);c(this,"value");this.building=e}simulate(e){if(!this.enabled)this.value=!0;else{const i=e.findTile(this.building,s=>{var n;return((n=s.building)==null?void 0:n.type)==="road"},w.modules.roadAccess.searchDistance);this.value=i!==null}}}var x;class ye extends ze{constructor(){super();c(this,"type","building");c(this,"hideTerrain",!1);c(this,"power",new Ut(this));c(this,"roadAccess",new Ft(this));c(this,"status",J.Ok);p(this,x,new ft);l(this,x).visible=!1,l(this,x).material=new gt({depthTest:!1}),l(this,x).layers.set(1),l(this,x).scale.set(.5,.5,.5),this.add(l(this,x))}setStatus(e){if(e!==this.status)switch(e){case J.NoPower:l(this,x).visible=!0,l(this,x).material.map=window.assetManager.statusIcons[J.NoPower];break;case J.NoRoadAccess:l(this,x).visible=!0,l(this,x).material.map=window.assetManager.statusIcons[J.NoRoadAccess];break;default:l(this,x).visible=!1}}simulate(e){super.simulate(e),this.power.simulate(e),this.roadAccess.simulate(e),this.power.isFullyPowered?this.roadAccess.value?this.setStatus(null):this.setStatus(J.NoRoadAccess):this.setStatus(J.NoPower)}dispose(){this.power.dispose(),this.roadAccess.dispose(),super.dispose()}toHTML(){let e=`
      <div class="info-heading">Building</div>
      <span class="info-label">Name </span>
      <span class="info-value">${this.name}</span>
      <br>
      <span class="info-label">Type </span>
      <span class="info-value">${this.type}</span>
      <br>
      <span class="info-label">Road Access </span>
      <span class="info-value">${this.roadAccess.value}</span>
      <br>`;return this.power.required>0&&(e+=`
        <span class="info-label">Power (kW)</span>
        <span class="info-value">${this.power.supplied}/${this.power.required}</span>
        <br>`),e}}x=new WeakMap;class Ce extends ye{constructor(e=0,i=0){super(e,i);c(this,"style",["A","B","C"][Math.floor(3*Math.random())]);c(this,"development",new Yt(this));this.name="Zone",this.power.required=10,this.rotation.y=90*Math.floor(4*Math.random())*B}refreshView(){let e;switch(this.development.state){case y.underConstruction:case y.undeveloped:e="under-construction";break;default:e=`${this.type}-${this.style}${this.development.level}`;break}let i=window.assetManager.getModel(e,this);this.development.state===y.abandoned&&i.traverse(s=>{s.material&&(s.material.color=new wt(7368816))}),this.setMesh(i)}simulate(e){super.simulate(e),this.development.simulate(e)}toHTML(){let e=super.toHTML();return e+=this.development.toHTML(),e}}class Xt extends Ce{constructor(e,i){super(e,i);c(this,"jobs",new st(this));this.name=Qt(),this.type=M.industrial}simulate(e){super.simulate(e),this.jobs.simulate()}dispose(){this.jobs.dispose(),super.dispose()}toHTML(){let e=super.toHTML();return e+=this.jobs.toHTML(),e}}const Ve=["Apex","Vortex","Elevate","Zenith","Nova","Synapse","Pulse","Enigma","Catalyst","Axiom"],Ge=["Dynamics","Ventures","Solutions","Technologies","Innovations","Industries","Enterprises","Systems","Mechanics","Manufacturing"],je=["LLC","Inc.","Co.","Corp.","Ltd."];function Qt(){const o=Ve[Math.floor(Math.random()*Ve.length)],t=Ge[Math.floor(Math.random()*Ge.length)],e=je[Math.floor(Math.random()*je.length)];return o+" "+t+" "+e}var j,S,me,et;class Kt extends re{constructor(e){super();p(this,me);p(this,j,void 0);p(this,S,[]);L(this,j,e)}get count(){return l(this,S).length}get maximum(){return Math.pow(w.modules.residents.maxResidents,l(this,j).development.level)}simulate(e){l(this,j).development.state===y.abandoned&&l(this,S).length>0?this.evictAll():l(this,j).development.state===y.developed&&l(this,S).length<this.maximum&&Math.random()<w.modules.residents.residentMoveInChance&&l(this,S).push(new _t(l(this,j)));for(const i of l(this,S))i.simulate(e)}dispose(){u(this,me,et).call(this)}toHTML(){let e=`<div class="info-heading">Residents (${l(this,S).length}/${this.maximum})</div>`;e+='<ul class="info-citizen-list">';for(const i of l(this,S))e+=i.toHTML();return e+="</ul>",e}}j=new WeakMap,S=new WeakMap,me=new WeakSet,et=function(){for(const e of l(this,S))e.dispose();L(this,S,[])};class qt extends Ce{constructor(e,i){super(e,i);c(this,"residents",new Kt(this));this.name=Zt(),this.type=M.residential}simulate(e){super.simulate(e),this.residents.simulate(e)}dispose(){this.residents.dispose(),super.dispose()}toHTML(){let e=super.toHTML();return e+=this.residents.toHTML(),e}}const He=["Emerald","Ivory","Crimson","Opulent","Celestial","Enchanted","Serene","Whispering","Stellar","Tranquil"],Ye=["Tower","Residence","Manor","Court","Plaza","House","Mansion","Place","Villa","Gardens"];function Zt(){const o=He[Math.floor(Math.random()*He.length)],t=Ye[Math.floor(Math.random()*Ye.length)];return o+" "+t}var pe,tt,fe,it;class _t{constructor(t){p(this,pe);p(this,fe);this.id=crypto.randomUUID(),this.name=ei(),this.age=1+Math.floor(100*Math.random()),this.state="idle",this.stateCounter=0,this.residence=t,this.workplace=null,u(this,pe,tt).call(this)}simulate(t){switch(this.state){case"idle":case"school":case"retired":break;case"unemployed":this.workplace=u(this,fe,it).call(this,t),this.workplace&&(this.state="employed");break;case"employed":this.workplace||(this.state="unemployed");break;default:console.error(`Citizen ${this.id} is in an unknown state (${this.state})`)}}dispose(){var e;const t=(e=this.workplace)==null?void 0:e.jobs.workers.indexOf(this);t!==void 0&&t>-1&&this.workplace.jobs.workers.splice(t)}setWorkplace(t){this.workplace=t}toHTML(){return`
      <li class="info-citizen">
        <span class="info-citizen-name">${this.name}</span>
        <br>
        <span class="info-citizen-details">
          <span>
            <img class="info-citizen-icon" src="/icons/calendar.png">
            ${this.age} 
          </span>
          <span>
            <img class="info-citizen-icon" src="/icons/job.png">
            ${this.state}
          </span>
        </span>
      </li>
    `}}pe=new WeakSet,tt=function(){this.age<w.citizen.minWorkingAge?this.state="school":this.age>=w.citizen.retirementAge?this.state="retired":this.state="unemployed"},fe=new WeakSet,it=function(t){const e=t.findTile(this.residence,i=>{var s,n;return(((s=i.building)==null?void 0:s.type)==="industrial"||((n=i.building)==null?void 0:n.type)==="commercial")&&i.building.jobs.availableJobs>0},w.citizen.maxJobSearchDistance);return e?(e.building.jobs.workers.push(this),e.building):null};function ei(){const o=["Emma","Olivia","Ava","Sophia","Isabella","Liam","Noah","William","James","Benjamin","Elizabeth","Margaret","Alice","Dorothy","Eleanor","John","Robert","William","Charles","Henry","Alex","Taylor","Jordan","Casey","Robin"],t=["Smith","Johnson","Williams","Jones","Brown","Davis","Miller","Wilson","Moore","Taylor","Anderson","Thomas","Jackson","White","Harris","Clark","Lewis","Walker","Hall","Young","Lee","King","Wright","Adams","Green"],e=o[Math.floor(Math.random()*o.length)],i=t[Math.floor(Math.random()*t.length)];return e+" "+i}var X,ae,Se;class st extends re{constructor(e){super();p(this,ae);p(this,X,void 0);c(this,"workers",[]);L(this,X,e)}get maxWorkers(){return l(this,X).development.state!==y.developed?0:Math.pow(w.modules.jobs.maxWorkers,l(this,X).development.level)}get availableJobs(){return this.maxWorkers-this.workers.length}get filledJobs(){return this.workers.length}simulate(e){l(this,X).development.state===y.abandoned&&u(this,ae,Se).call(this)}dispose(){u(this,ae,Se).call(this)}toHTML(){let e=`<div class="info-heading">Workers (${this.filledJobs}/${this.maxWorkers})</div>`;e+='<ul class="info-citizen-list">';for(const i of this.workers)e+=i.toHTML();return e+="</ul>",e}}X=new WeakMap,ae=new WeakSet,Se=function(){for(const e of this.workers)e.setWorkplace(null);this.workers=[]};class ti extends Ce{constructor(e,i){super(e,i);c(this,"jobs",new st(this));this.name=ii(),this.type=M.commercial}simulate(e){super.simulate(e),this.jobs.simulate()}dispose(){this.jobs.dispose(),super.dispose()}toHTML(){let e=super.toHTML();return e+=this.jobs.toHTML(),e}}const Je=["Prime","Elite","Global","Exquisite","Vibrant","Luxury","Innovative","Sleek","Premium","Dynamic"],$e=["Commerce","Trade","Marketplace","Ventures","Enterprises","Retail","Group","Emporium","Boutique","Mall"],Ue=["LLC","Inc.","Co.","Corp.","Ltd."];function ii(){const o=Je[Math.floor(Math.random()*Je.length)],t=$e[Math.floor(Math.random()*$e.length)],e=Ue[Math.floor(Math.random()*Ue.length)];return o+" "+t+" "+e}class si extends ye{constructor(t,e){super(t,e),this.type="road",this.name="Road",this.style="straight",this.hideTerrain=!0,this.roadAccess.enabled=!1}refreshView(t){var r,h,f,A,T,v,z,C;let e=((h=(r=t.getTile(this.x,this.y-1))==null?void 0:r.building)==null?void 0:h.type)===this.type,i=((A=(f=t.getTile(this.x,this.y+1))==null?void 0:f.building)==null?void 0:A.type)===this.type,s=((v=(T=t.getTile(this.x-1,this.y))==null?void 0:T.building)==null?void 0:v.type)===this.type,n=((C=(z=t.getTile(this.x+1,this.y))==null?void 0:z.building)==null?void 0:C.type)===this.type;e&&i&&s&&n?(this.style="four-way",this.rotation.y=0):!e&&i&&s&&n?(this.style="three-way",this.rotation.y=0):e&&!i&&s&&n?(this.style="three-way",this.rotation.y=180*B):e&&i&&!s&&n?(this.style="three-way",this.rotation.y=90*B):e&&i&&s&&!n?(this.style="three-way",this.rotation.y=270*B):e&&!i&&s&&!n?(this.style="corner",this.rotation.y=180*B):e&&!i&&!s&&n?(this.style="corner",this.rotation.y=90*B):!e&&i&&s&&!n?(this.style="corner",this.rotation.y=270*B):!e&&i&&!s&&n?(this.style="corner",this.rotation.y=0):e&&i&&!s&&!n?(this.style="straight",this.rotation.y=0):!e&&!i&&s&&n?(this.style="straight",this.rotation.y=90*B):e&&!i&&!s&&!n?(this.style="end",this.rotation.y=180*B):!e&&i&&!s&&!n?(this.style="end",this.rotation.y=0):!e&&!i&&s&&!n?(this.style="end",this.rotation.y=270*B):!e&&!i&&!s&&n&&(this.style="end",this.rotation.y=90*B);const a=window.assetManager.getModel(`road-${this.style}`,this);this.setMesh(a),t.vehicleGraph.updateTile(this.x,this.y,this)}toHTML(){let t=super.toHTML();return t+=`
    <span class="info-label">Style </span>
    <span class="info-value">${this.style}</span>
    <br>
    `,t}}class ni extends ye{constructor(e,i){super(e,i);c(this,"powerCapacity",100);c(this,"powerConsumed",0);this.type=M.powerPlant}get powerAvailable(){return this.roadAccess.value?this.powerCapacity-this.powerConsumed:0}refreshView(){let e=window.assetManager.getModel(this.type,this);this.setMesh(e)}toHTML(){let e=super.toHTML();return e+=`
      <div class="info-heading">Power</div>
      <span class="info-label">Power Capacity (kW)</span>
      <span class="info-value">${this.powerCapacity}</span>
      <br>
      <span class="info-label">Power Consumed (kW)</span>
      <span class="info-value">${this.powerConsumed}</span>
      <br>
      <span class="info-label">Power Available (kW)</span>
      <span class="info-value">${this.powerAvailable}</span>
      <br>
    `,e}}const N={Left:"left",Right:"right",Top:"top",Bottom:"bottom"},oi=new bt({color:0});var Q,ie,E,P;class ai extends ye{constructor(e,i){super(e,i);p(this,Q);p(this,E);this.type=M.powerLine,this.roadAccess.enabled=!1}refreshView(e){var f,A,T,v,z,C,D,I;let i=new H,s=window.assetManager.getModel(this.type,this);s.rotation.y=Math.PI/4;let n=((A=(f=e.getTile(this.x,this.y-1))==null?void 0:f.building)==null?void 0:A.type)===this.type,a=((v=(T=e.getTile(this.x,this.y+1))==null?void 0:T.building)==null?void 0:v.type)===this.type,r=((C=(z=e.getTile(this.x-1,this.y))==null?void 0:z.building)==null?void 0:C.type)===this.type,h=((I=(D=e.getTile(this.x+1,this.y))==null?void 0:D.building)==null?void 0:I.type)===this.type;i.add(s),n&&u(this,Q,ie).call(this,i,N.Top),a&&u(this,Q,ie).call(this,i,N.Bottom),r&&u(this,Q,ie).call(this,i,N.Left),h&&u(this,Q,ie).call(this,i,N.Right),this.setMesh(i)}}Q=new WeakSet,ie=function(e,i){switch(i){case N.Left:e.add(u(this,E,P).call(this,-.09,.36,.09,-.5,.36,.09)),e.add(u(this,E,P).call(this,-.09,.36,-.09,-.5,.36,-.09));break;case N.Right:e.add(u(this,E,P).call(this,.09,.36,.09,.5,.36,.09)),e.add(u(this,E,P).call(this,.09,.36,-.09,.5,.36,-.09));break;case N.Top:e.add(u(this,E,P).call(this,.09,.36,-.09,.09,.36,-.5)),e.add(u(this,E,P).call(this,-.09,.36,-.09,-.09,.36,-.5));break;case N.Bottom:e.add(u(this,E,P).call(this,.09,.36,.09,.09,.36,.5)),e.add(u(this,E,P).call(this,-.09,.36,.09,-.09,.36,.5));break}},E=new WeakSet,P=function(e,i,s,n,a,r){const h=[new b(e,i,s),new b(n,a,r)],f=new At().setFromPoints(h),A=new yt(f,oi);return A.layers.set(1),A};function ri(o,t,e){switch(e){case M.residential:return new qt;case M.commercial:return new ti;case M.industrial:return new Xt;case M.road:return new si;case M.powerPlant:return new ni;case M.powerLine:return new ai;default:console.error(`${e} is not a recognized building type.`)}}var O;class li extends ze{constructor(e,i){super(e,i);c(this,"terrain","grass");p(this,O,null);this.name=`Tile-${this.x}-${this.y}`}get building(){return l(this,O)}setBuilding(e){l(this,O)&&(l(this,O).dispose(),this.remove(l(this,O))),L(this,O,e),e&&this.add(l(this,O))}refreshView(e){var i,s;if((i=this.building)==null||i.refreshView(e),(s=this.building)!=null&&s.hideTerrain)this.setMesh(null);else{const n=window.assetManager.getModel(this.terrain,this);n.name=this.terrain,this.setMesh(n)}}simulate(e){var i;(i=this.building)==null||i.simulate(e)}distanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}toHTML(){let e=`
      <div class="info-heading"></div>
      <span class="info-label">Koordinat </span>
      <span class="info-value">X: ${this.x}, Y: ${this.y}</span>
      <br>
      <span class="info-label">Nama</span>
      <span class="info-value">${this.terrain}</span>
      <br>
    `;return this.building&&(e+=this.building.toHTML()),e}}O=new WeakMap;class m extends Xe{constructor(t,e){super(),this.position.set(t,0,e),this.next=[]}connect(t){t&&(this.next.includes(t)||this.next.push(t))}disconnectAll(){this.next=[]}getRandomNextNode(){if(this.next.length===0)return null;{const t=Math.floor(this.next.length*Math.random());return this.next[t]}}}const d=.05,g=.25;class ee extends H{constructor(t,e,i){super(),this.position.set(t,0,e),this.rotation.set(0,i,0),this.roadRotation=Math.round(i*Mt),this.left={in:null,out:null},this.right={in:null,out:null},this.top={in:null,out:null},this.bottom={in:null,out:null}}static create(t,e,i,s){switch(s){case"end":return new hi(t,e,i);case"straight":return new di(t,e,i);case"corner":return new ci(t,e,i);case"three-way":return new ui(t,e,i);case"four-way":return new mi(t,e,i);default:console.error(`Road type ${s} is not a known value`)}}disconnectAll(){for(let t of this.children)t.disconnectAll(),t.removeFromParent()}getRandomNode(){const t=[];if(this.left.in&&t.push(this.left.in),this.right.in&&t.push(this.right.in),this.top.in&&t.push(this.top.in),this.bottom.in&&t.push(this.bottom.in),t.length>0){const e=Math.floor(t.length*Math.random());return t[e]}else return null}getWorldLeftSide(){switch(this.roadRotation){case 0:return this.left;case 90:return this.top;case 180:return this.right;case 270:return this.bottom;default:return this.left}}getWorldRightSide(){switch(this.roadRotation){case 0:return this.right;case 90:return this.bottom;case 180:return this.left;case 270:return this.top;default:return this.right}}getWorldTopSide(){switch(this.roadRotation){case 0:return this.top;case 90:return this.right;case 180:return this.bottom;case 270:return this.left;default:return this.top}}getWorldBottomSide(){switch(this.roadRotation){case 0:return this.bottom;case 90:return this.left;case 180:return this.top;case 270:return this.right;default:return this.bottom}}}class hi extends ee{constructor(t,e,i){super(t,e,i),this.name=`EndRoadTile (${this.position})`,this.bottom={in:new m(d,g),out:new m(-d,g)};const s={in:new m(d,0),out:new m(-d,0)};this.add(this.bottom.in),this.add(this.bottom.out),this.add(s.in),this.add(s.out),this.bottom.in.connect(s.in),s.in.connect(s.out),s.out.connect(this.bottom.out)}}class di extends ee{constructor(t,e,i){super(t,e,i),this.name=`StraightRoadTile (${this.position})`,this.top={in:new m(-d,-g),out:new m(d,-g)},this.bottom={in:new m(d,g),out:new m(-d,g)},this.add(this.top.in),this.add(this.top.out),this.add(this.bottom.in),this.add(this.bottom.out),this.bottom.in.connect(this.top.out),this.top.in.connect(this.bottom.out)}}class ci extends ee{constructor(t,e,i){super(t,e,i),this.name=`CornerRoadTile (${this.position})`,this.bottom={in:new m(d,g+.1),out:new m(-d,g+.1)},this.right={in:new m(g+.1,-d),out:new m(g+.1,d)};const s=new m(g-1.5*d,g-1.5*d),n=new m(g-3*d,g-3*d);this.add(s),this.add(n),this.add(this.right.in),this.add(this.right.out),this.add(this.bottom.in),this.add(this.bottom.out),this.bottom.in.connect(s),s.connect(this.right.out),this.right.in.connect(n),n.connect(this.bottom.out)}}class ui extends ee{constructor(t,e,i){super(t,e,i),this.name=`TeeRoadTile (${this.position})`,this.left={in:new m(-g,d),out:new m(-g,-d)},this.right={in:new m(g,-d),out:new m(g,d)},this.bottom={in:new m(d,g),out:new m(-d,g)};const s=new m(-d,d),n=new m(d,d),a=new m(-d,-d),r=new m(d,-d);this.add(this.left.in),this.add(this.left.out),this.add(this.right.in),this.add(this.right.out),this.add(this.bottom.in),this.add(this.bottom.out),this.add(s),this.add(n),this.add(a),this.add(r),s.connect(n),n.connect(r),r.connect(a),a.connect(s),this.left.in.connect(s),this.right.in.connect(r),this.bottom.in.connect(n),s.connect(this.bottom.out),n.connect(this.right.out),a.connect(this.left.out)}}class mi extends ee{constructor(t,e,i){super(t,e,i),this.name=`IntersectionRoadTile (${this.position})`,this.left={in:new m(-g,d),out:new m(-g,-d)},this.right={in:new m(g,-d),out:new m(g,d)},this.bottom={in:new m(d,g),out:new m(-d,g)},this.top={in:new m(-d,-g),out:new m(d,-g)};const s=new m(-d,d),n=new m(d,d),a=new m(-d,-d),r=new m(d,-d);this.add(this.left.in),this.add(this.left.out),this.add(this.right.in),this.add(this.right.out),this.add(this.bottom.in),this.add(this.bottom.out),this.add(this.top.in),this.add(this.top.out),this.add(s),this.add(n),this.add(a),this.add(r),s.connect(n),n.connect(r),r.connect(a),a.connect(s),this.left.in.connect(s),this.right.in.connect(r),this.bottom.in.connect(n),this.top.in.connect(a),s.connect(this.bottom.out),n.connect(this.right.out),r.connect(this.top.out),a.connect(this.left.out)}}const pi=new b(0,1,0),fi=new Tt(.03,6,6),gi=new vt(.02,1,6),wi=new Ae({color:5263615}),bi=new Ae({color:65280}),Ai=new Ae({color:16711680});class yi extends H{constructor(){super(),this.visible=!1}refreshView(t){this.clear();for(let e=0;e<t.size;e++)for(let i=0;i<t.size;i++){const s=t.getTile(e,i);if(s)for(const n of s.children)this.createNodeVisualization(n)}}createNodeVisualization(t){const e=new ve(fi,t.next.length>0?bi:Ai),i=new b;if(t.getWorldPosition(i),e.position.set(i.x,i.y,i.z),t.next.length>0)for(const s of t.next){const n=new b;s.getWorldPosition(n);const a=new b;a.copy(n),a.sub(i);const r=a.length(),h=new ve(gi,wi);h.scale.set(1,r,1),h.quaternion.setFromUnitVectors(pi,a.clone().normalize());const f=new b(0,r/2,0).applyQuaternion(h.quaternion.clone());h.position.set(i.x+f.x,i.y+f.y,i.z+f.z),this.add(h)}this.add(e)}}const Mi=new b(1,0,0);class Ti extends ze{constructor(t,e){super(),this.createdTime=Date.now(),this.cycleStartTime=this.createdTime,this.origin=t,this.destination=e,this.originWorldPosition=new b,this.destinationWorldPosition=new b,this.originToDestination=new b,this.orientation=new b,this.updateWorldPositions();const i=Object.entries(Le).filter(n=>n[1].type==="vehicle").map(n=>n[0]),s=Math.floor(i.length*Math.random());this.setMesh(window.assetManager.getModel(i[s],this,!0))}get cycleTime(){const e=this.originToDestination.length()/w.vehicle.speed,i=(Date.now()-this.cycleStartTime)/e;return Math.max(0,Math.min(i,1))}get age(){return Date.now()-this.createdTime}simulate(){if(!this.origin||!this.destination){this.dispose();return}if(!this.destination.parent){this.dispose();return}if(this.age>w.vehicle.maxLifetime){this.dispose();return}this.cycleTime===1?this.pickNewDestination():(this.position.copy(this.originWorldPosition),this.position.lerp(this.destinationWorldPosition,this.cycleTime)),this.updateOpacity()}updateOpacity(){const t=e=>{this.traverse(i=>{i.material&&(i.material.opacity=Math.max(0,Math.min(e,1)))})};this.age<w.vehicle.fadeTime?t(this.age/w.vehicle.fadeTime):w.vehicle.maxLifetime-this.age<w.vehicle.fadeTime?t((w.vehicle.maxLifetime-this.age)/w.vehicle.fadeTime):t(1)}pickNewDestination(){var t;this.origin=this.destination,this.destination=(t=this.origin)==null?void 0:t.getRandomNextNode(),this.updateWorldPositions(),this.cycleStartTime=Date.now()}updateWorldPositions(){!this.origin||!this.destination||(this.origin.getWorldPosition(this.originWorldPosition),this.destination.getWorldPosition(this.destinationWorldPosition),this.originToDestination.copy(this.destinationWorldPosition),this.originToDestination.sub(this.originWorldPosition),this.orientation.copy(this.originToDestination),this.orientation.normalize(),this.quaternion.setFromUnitVectors(Mi,this.orientation))}dispose(){this.traverse(t=>{var e;return(e=t.material)==null?void 0:e.dispose()}),this.removeFromParent()}toHTML(){return"Car"}}class vi extends H{constructor(t){super(),this.size=t,this.tiles=[],this.vehicles=new H,this.add(this.vehicles),this.helper=new yi,this.add(this.helper);for(let e=0;e<this.size;e++){const i=[];for(let s=0;s<this.size;s++)i.push(null);this.tiles.push(i)}this.helper.refreshView(this),setInterval(this.spawnVehicle.bind(this),w.vehicle.spawnInterval)}updateVehicles(){for(const t of this.vehicles.children)t.simulate()}updateTile(t,e,i){var f,A,T,v,z,C,D,I,R,Be,Ee,We,ke,Re,Pe,Oe;const s=this.getTile(t,e),n=this.getTile(t-1,e),a=this.getTile(t+1,e),r=this.getTile(t,e-1),h=this.getTile(t,e+1);if(s==null||s.disconnectAll(),(A=(f=n==null?void 0:n.getWorldRightSide())==null?void 0:f.out)==null||A.disconnectAll(),(v=(T=a==null?void 0:a.getWorldLeftSide())==null?void 0:T.out)==null||v.disconnectAll(),(C=(z=r==null?void 0:r.getWorldBottomSide())==null?void 0:z.out)==null||C.disconnectAll(),(I=(D=h==null?void 0:h.getWorldTopSide())==null?void 0:D.out)==null||I.disconnectAll(),i){const W=ee.create(t,e,i.rotation.y,i.style);n&&((R=W.getWorldLeftSide().out)==null||R.connect(n.getWorldRightSide().in),(Be=n.getWorldRightSide().out)==null||Be.connect(W.getWorldLeftSide().in)),a&&((Ee=W.getWorldRightSide().out)==null||Ee.connect(a.getWorldLeftSide().in),(We=a.getWorldLeftSide().out)==null||We.connect(W.getWorldRightSide().in)),r&&((ke=W.getWorldTopSide().out)==null||ke.connect(r.getWorldBottomSide().in),(Re=r.getWorldBottomSide().out)==null||Re.connect(W.getWorldTopSide().in)),h&&((Pe=W.getWorldBottomSide().out)==null||Pe.connect(h.getWorldTopSide().in),(Oe=h.getWorldTopSide().out)==null||Oe.connect(W.getWorldBottomSide().in)),this.tiles[t][e]=W,this.add(W)}else this.tiles[t][e]=null;this.helper.refreshView(this)}getTile(t,e){return t>=0&&t<this.size&&e>=0&&e<this.size?this.tiles[t][e]:null}spawnVehicle(){const t=this.getStartingTile();if(t!=null){const e=t.getRandomNode(),i=e==null?void 0:e.getRandomNextNode();if(e&&i){const s=new Ti(e,i);this.vehicles.add(s)}}}getStartingTile(){const t=[];for(let e=0;e<this.size;e++)for(let i=0;i<this.size;i++){let s=this.getTile(e,i);s&&t.push(s)}if(t.length===0)return null;{const e=Math.floor(t.length*Math.random());return t[e]}}}class Li{simulate(t){const e=[];for(let s=0;s<t.size;s++)for(let n=0;n<t.size;n++){const a=t.getTile(s,n),r=t.getTile(s,n).building;if(r)if(r.type===M.powerPlant){const h=r;h.powerConsumed=0,e.push({powerPlant:h,frontier:[a],visited:[]})}else r.power.supplied=0}if(e.length===0)return;let i=!0;for(;i;){i=!1;for(const s of e){const{powerPlant:n,frontier:a,visited:r}=s;if(n.powerAvailable!==0&&a.length>0){i=!0;const h=a.shift(),f=h.building;if(r.push(h),f.power.supplied<f.power.required){const R=Math.min(n.powerAvailable,f.power.required);n.powerConsumed+=R,f.power.supplied=R}const{x:A,y:T}=h,v=R=>R&&!r.includes(R)&&R.building;let z=t.getTile(A-1,T),C=t.getTile(A+1,T),D=t.getTile(A,T-1),I=t.getTile(A,T+1);v(z)&&a.push(z),v(C)&&a.push(C),v(D)&&a.push(D),v(I)&&a.push(I)}}}}dispose(){}toHTML(){}}class xi extends H{constructor(e,i="Semarang"){super();c(this,"debugMeshes",new H);c(this,"root",new H);c(this,"services",[]);c(this,"size",16);c(this,"simTime",0);c(this,"tiles",[]);c(this,"vehicleGraph");this.name=i,this.size=e,this.add(this.debugMeshes),this.add(this.root),this.tiles=[];for(let s=0;s<this.size;s++){const n=[];for(let a=0;a<this.size;a++){const r=new li(s,a);r.refreshView(this),this.root.add(r),n.push(r)}this.tiles.push(n)}this.services=[],this.services.push(new Li),this.vehicleGraph=new vi(this.size),this.debugMeshes.add(this.vehicleGraph)}get population(){var i,s;let e=0;for(let n=0;n<this.size;n++)for(let a=0;a<this.size;a++){const r=this.getTile(n,a);e+=((s=(i=r.building)==null?void 0:i.residents)==null?void 0:s.count)??0}return e}getTile(e,i){return e===void 0||i===void 0||e<0||i<0||e>=this.size||i>=this.size?null:this.tiles[e][i]}simulate(e=1){let i=0;for(;i++<e;){this.services.forEach(s=>s.simulate(this));for(let s=0;s<this.size;s++)for(let n=0;n<this.size;n++)this.getTile(s,n).simulate(this)}this.simTime++}placeBuilding(e,i,s){var a,r,h,f;const n=this.getTile(e,i);n&&!n.building&&(n.setBuilding(ri(e,i,s)),n.refreshView(this),(a=this.getTile(e-1,i))==null||a.refreshView(this),(r=this.getTile(e+1,i))==null||r.refreshView(this),(h=this.getTile(e,i-1))==null||h.refreshView(this),(f=this.getTile(e,i+1))==null||f.refreshView(this),n.building.type===M.road&&this.vehicleGraph.updateTile(e,i,n.building))}bulldoze(e,i){var n,a,r,h;const s=this.getTile(e,i);s.building&&(s.building.type===M.road&&this.vehicleGraph.updateTile(e,i,null),s.building.dispose(),s.setBuilding(null),s.refreshView(this),(n=this.getTile(e-1,i))==null||n.refreshView(this),(a=this.getTile(e+1,i))==null||a.refreshView(this),(r=this.getTile(e,i-1))==null||r.refreshView(this),(h=this.getTile(e,i+1))==null||h.refreshView(this))}draw(){this.vehicleGraph.updateVehicles()}findTile(e,i,s){const n=this.getTile(e.x,e.y),a=new Set,r=[];for(r.push(n);r.length>0;){const h=r.shift();if(!(a.has(h.id)||(a.add(h.id),n.distanceTo(h)>s))&&(r.push(...this.getTileNeighbors(h.x,h.y)),i(h)))return h}return null}getTileNeighbors(e,i){const s=[];return e>0&&s.push(this.getTile(e-1,i)),e<this.size-1&&s.push(this.getTile(e+1,i)),i>0&&s.push(this.getTile(e,i-1)),i<this.size-1&&s.push(this.getTile(e,i+1)),s}}var ge,nt,we,ot,be,at;class Si{constructor(t){p(this,ge);p(this,we);p(this,be);c(this,"city");c(this,"focusedObject",null);c(this,"inputManager");c(this,"selectedObject",null);this.city=t,this.renderer=new Lt({antialias:!0}),this.scene=new xt,this.inputManager=new Ht(window.ui.gameWindow),this.cameraManager=new jt(window.ui.gameWindow),this.renderer.setSize(window.ui.gameWindow.clientWidth,window.ui.gameWindow.clientHeight),this.renderer.setClearColor(0,0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=St,window.ui.gameWindow.appendChild(this.renderer.domElement),this.raycaster=new zt,window.assetManager=new Rt(()=>{window.ui.hideLoadingText(),this.city=new xi(16),this.initialize(this.city),this.start(),setInterval(this.simulate.bind(this),1e3)}),window.addEventListener("resize",this.onResize.bind(this),!1)}initialize(t){this.scene.clear(),this.scene.add(t),u(this,we,ot).call(this),u(this,ge,nt).call(this,t)}start(){this.renderer.setAnimationLoop(this.draw.bind(this))}stop(){this.renderer.setAnimationLoop(null)}draw(){this.city.draw(),this.updateFocusedObject(),this.inputManager.isLeftMouseDown&&this.useTool(),this.renderer.render(this.scene,this.cameraManager.camera)}simulate(){window.ui.isPaused||(this.city.simulate(1),window.ui.updateTitleBar(this),window.ui.updateInfoPanel(this.selectedObject))}useTool(){switch(window.ui.activeToolId){case"select":this.updateSelectedObject(),window.ui.updateInfoPanel(this.selectedObject);break;case"bulldoze":if(this.focusedObject){const{x:t,y:e}=this.focusedObject;this.city.bulldoze(t,e)}break;default:if(this.focusedObject){const{x:t,y:e}=this.focusedObject;this.city.placeBuilding(t,e,window.ui.activeToolId)}break}}updateSelectedObject(){var t,e;(t=this.selectedObject)==null||t.setSelected(!1),this.selectedObject=this.focusedObject,(e=this.selectedObject)==null||e.setSelected(!0)}updateFocusedObject(){var e,i;(e=this.focusedObject)==null||e.setFocused(!1);const t=u(this,be,at).call(this);t!==this.focusedObject&&(this.focusedObject=t),(i=this.focusedObject)==null||i.setFocused(!0)}onResize(){this.cameraManager.resize(window.ui.gameWindow),this.renderer.setSize(window.ui.gameWindow.clientWidth,window.ui.gameWindow.clientHeight)}}ge=new WeakSet,nt=function(t){const e=new Ae({color:0,map:window.assetManager.textures.grid,transparent:!0,opacity:.2});e.map.repeat=new Ct(t.size,t.size),e.map.wrapS=t.size,e.map.wrapT=t.size;const i=new ve(new Bt(t.size,.1,t.size),e);i.position.set(t.size/2-.5,-.04,t.size/2-.5),this.scene.add(i)},we=new WeakSet,ot=function(){const t=new Et(16777215,2);t.position.set(-10,20,0),t.castShadow=!0,t.shadow.camera.left=-20,t.shadow.camera.right=20,t.shadow.camera.top=20,t.shadow.camera.bottom=-20,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=10,t.shadow.camera.far=50,t.shadow.normalBias=.01,this.scene.add(t),this.scene.add(new Wt(16777215,.5))},be=new WeakSet,at=function(){var t={x:this.inputManager.mouse.x/this.renderer.domElement.clientWidth*2-1,y:-(this.inputManager.mouse.y/this.renderer.domElement.clientHeight)*2+1};this.raycaster.setFromCamera(t,this.cameraManager.camera);let e=this.raycaster.intersectObjects(this.city.root.children,!0);return e.length>0?e[0].object.userData:null};window.onload=()=>{window.game=new Si};function zi(){let o=0,t=0;document.addEventListener("touchstart",s=>{o=s.touches[0].clientX,t=s.touches[0].clientY},!1),document.addEventListener("touchmove",s=>{if(!s.touches.length)return;const n=s.touches[0].clientX,a=s.touches[0].clientY,r=o-n,h=t-a;camera.position.x+=r*.1,camera.position.z+=h*.1,o=n,t=a,s.preventDefault()},{passive:!1});let e=null,i=null;document.addEventListener("touchstart",s=>{s.touches.length===2&&(e=Fe(s),i=camera.position.y)}),document.addEventListener("touchmove",s=>{if(s.touches.length===2&&e!==null){const n=Fe(s),a=e/n;camera.position.y=i*a,camera.position.y=Math.max(10,Math.min(100,camera.position.y)),s.preventDefault()}}),document.addEventListener("touchend",()=>{e=null})}function Fe(o){return Math.hypot(o.touches[0].clientX-o.touches[1].clientX,o.touches[0].clientY-o.touches[1].clientY)}zi();const Ci="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAACtklEQVR4nO3dvYoTURjG8f9x7RSdWxAsBCsbrbwAb2TBm7EUbL0BkUXEVlA7CyULy+JHp4XoENcFRTkWmZXJuq8GOZ73fDw/CCQQZkL+5EkCgYQYI+LnlPcD6J0COFMAZwrgTAGcKYAzBXCmAM4UwJkCOFMAZwrgTAGcKYAzBXCmAM4UwNnpVAe6cPtgJwSWwK0Y2Q+BQ+B7jBDC6j4tXIfV7dc3z/7rU7UmWYAQuA58Aw6AF8Az4Hmq47cqWQDgDHAe2AaWwAPgHrALvAM+JjxXM1IG+HF0vBA4B9wArgB7wA5wH/iQ8HxNSB1gbgCGELgEXASuomn6TcoAf3J5umiajskVANA0nSRrgMmApukXjwBz3U+TdwCg72kqIsBkoMNpKinAXDfTVGoAoI9pKjrAZKDhaaohwFxz01RbAKCtaaoywGSggWmqOcBctdPUSgCgzmlqKsBkoKJpajHAXPHT1HoAoOxp6iLAZKDAaeopwFwx09RrAKCMaeo6wGTAcZoUYF32aVKAE+ScJgWwDaxP0zVWr4aXwFvgVYqTKMBmjqbpC3AXeESiAPp5ujO9AjazAJ6yPkFJKIBtBN7HyF4IehPOKkaWIfAQfQzNbgE8QV/EshrJMDWWrgPknBpLrwGyT42lpwAjjlNj6SJACVNjaT1AMVNjaTHASIFTY2kqQMlTY2klQPFTY6k5wEhFU2OpMkCNU2OpLUC1U2OpIcBIA1NjKTpAS1NjKTVAc1NjKSnASMNTYykiQA9TY/EO0M3UWDwCjHQ4NZasAXqeGkuuAN1PjSVlgK1jt0c0NX/1XwJoajaXMsBn4CurJ32BpmYjKQM8hvgpRu5AeAMcJjx2s4L+TdWXfp7uTAGcKYAzBXCmAM4UwJkCOFMAZwrgTAGcKYAzBXCmAM4UwJkCOFMAZwrg7CftJluytFjI3AAAAABJRU5ErkJggg==",Bi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAABe0lEQVR4nO3doU4DQRhF4VvSNIXUgUQRJG9VxROheCskQSHBEWhqFjNucf8/OYLzmVW9meYkXTfdLMsScS7oA/x3BoAZAGYAmAFgBoAZAGYAmAFgBoAZAGYAmAFgBoAZAGYAmAFg2xmjd09fH0kuizMvSY7jWfGQ5Hk8K37eHg83xY2VKQGSXDds3CfZN+zsx9ZVcaf6+T/N+gn6bth4T3Ju2DmPraqO77TiOwBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYAaAGQBmAJgBYLMCdFxyeptk17CzG1tVUy5unXVz7mfqVxe/Jjk1nOU0tspXFzecZWXjv6myfAfADAAzAMwAMAPADAAzAMwAMAPADAAzAMwAMAPADAAzAMwAMAPAfgF34xr/N0jiRwAAAABJRU5ErkJggg==";class Ei{constructor(){c(this,"activeToolId","select");c(this,"selectedControl",document.getElementById("button-select"));c(this,"isPaused",!1)}get gameWindow(){return document.getElementById("render-target")}showLoadingText(){document.getElementById("loading").style.visibility="visible"}hideLoadingText(){document.getElementById("loading").style.visibility="hidden"}onToolSelected(t){this.selectedControl&&this.selectedControl.classList.remove("selected"),this.selectedControl=t.target,this.selectedControl.classList.add("selected"),this.activeToolId=this.selectedControl.getAttribute("data-type")}togglePause(){this.isPaused=!this.isPaused,this.isPaused?(document.getElementById("pause-button-icon").src=Ci,document.getElementById("paused-text").style.visibility="visible"):(document.getElementById("pause-button-icon").src=Bi,document.getElementById("paused-text").style.visibility="hidden")}updateTitleBar(t){document.getElementById("city-name").innerHTML=t.city.name,document.getElementById("population-counter").innerHTML=t.city.population;const e=new Date("1/1/2025");e.setDate(e.getDate()+t.city.simTime),document.getElementById("sim-time").innerHTML=e.toLocaleDateString()}updateInfoPanel(t){const e=document.getElementById("info-panel");t?(e.style.visibility="hidden",e.innerHTML=t.toHTML()):(e.style.visibility="hidden",e.innerHTML="")}}window.ui=new Ei;
